---
title: Web API é£æ ¼æŒ‡å—
---

## Web API è®¾è®¡æŒ‡å—

éµå¾ª RESTful apiã€‚è€ƒè™‘ä»¥ä¸‹å†…å®¹ï¼š

- ç‰ˆæœ¬ï¼š`/api/v1/`
- èµ„æºï¼šURIè¡¨ç¤ºæŸä¸€èµ„æº
- åŠ¨ä½œï¼šHTTPæ–¹æ³•è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œ
- [æ•°æ®](./schema.md)ï¼šJSONæ ¼å¼æ•°æ®(è¯·æ±‚å’Œå“åº”)ï¼Œå¸¦æ ¡éªŒ
- çŠ¶æ€ç ï¼šHTTPçŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚ç»“æœ
- [è®¤è¯](./auth.md)ï¼šOAuth 2ä½¿ç”¨äº†[æ‰¿è½½ä»¤ç‰Œ(Bearer tokens](http://tools.ietf.org/html/rfc6750)) å¹¶ä¸”ä¾èµ–äºSSLçš„åº•å±‚ä¼ è¾“åŠ å¯†ã€‚
- ç¼“å­˜ï¼š[ETag](http://en.wikipedia.org/wiki/HTTP_ETag)å’Œ[Last-Modified](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.29)
- é”™è¯¯


## 1. RESTful APIè®¾è®¡è§„èŒƒ

### 1.1 èµ„æº

- èµ„æºåå°½å¯èƒ½ä½¿ç”¨åè¯ï¼Œä¸ä½¿ç”¨åŠ¨è¯
- URIä¸­çš„åè¯è¡¨ç¤ºèµ„æºçš„é›†åˆï¼Œä½¿ç”¨å¤æ•°å½¢å¼
- URIä¸­å¯ä»¥åŒ…å«å­èµ„æºï¼Œç”¨/åˆ†éš”ï¼ŒåµŒå¥—å±‚çº§ä¸è¦è¶…è¿‡ä¸‰å±‚
- URIä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢å‚æ•°ï¼Œç”¨?åˆ†éš”
- URIä¸­çš„æŸ¥è¯¢å‚æ•°ï¼Œåº”è¯¥è¡¨ç¤ºä¸ºèµ„æºçš„å±æ€§ï¼Œ è¿‡æ»¤ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œ
- å¤æ‚å‚æ•°ä½¿ç”¨ Bodyï¼ˆJSON æ ¼å¼ï¼‰

### 1.2 åŠ¨ä½œ

ä½¿ç”¨HTTPæ–¹æ³•è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œ
- GETï¼šæŸ¥è¯¢èµ„æº
- POSTï¼šåˆ›å»ºèµ„æº
- PUTï¼šæ›´æ–°èµ„æº
- DELETEï¼šåˆ é™¤èµ„æº

### 1.3 æ•°æ®

- æ•°æ®ä½¿ç”¨JSONæ ¼å¼
- æ•°æ®çš„é”®ä½¿ç”¨`_`è¿æ¥å•è¯

### 1.4 çŠ¶æ€ç 

- 200ï¼šæˆåŠŸï¼ˆæŸ¥è¯¢ï¼‰
   - 201ï¼šæˆåŠŸï¼Œèµ„æºè¢«åˆ›å»º
   - 203ï¼šæˆåŠŸï¼Œèµ„æºè¢«ä¿®æ”¹
   - 204ï¼šæˆåŠŸï¼Œæ— å†…å®¹ï¼ˆå¯ä»¥è¡¨ç¤ºåˆ é™¤æˆåŠŸï¼‰
   - 206ï¼šéƒ¨åˆ†æˆåŠŸï¼ˆåˆ†å—ä¸‹è½½ï¼‰
- 300ï¼šé‡å®šå‘
  - 301ï¼šæ°¸ä¹…é‡å®šå‘
  - 302ï¼šä¸´æ—¶é‡å®šå‘
  - 304ï¼šèµ„æºæœªä¿®æ”¹ï¼Œä½¿ç”¨ç¼“å­˜
- 400ï¼šå®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯
  - 401ï¼šå®¢æˆ·ç«¯æœªè®¤è¯
  - 403ï¼šå®¢æˆ·ç«¯è®¤è¯é€šè¿‡ï¼Œä½†æ˜¯æ²¡æœ‰æƒé™
  - 404ï¼šèµ„æºä¸å­˜åœ¨
  - 405ï¼šHTTPæ–¹æ³•ä¸æ”¯æŒ
  - 429ï¼šè¯·æ±‚è¿‡å¤šï¼Œé™æµ
- 500ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  - 501ï¼šæœåŠ¡å™¨ä¸æ”¯æŒå½“å‰è¯·æ±‚æ‰€éœ€è¦çš„æŸä¸ªåŠŸèƒ½(å³å°†å¼€ä¸š)
  - 502ï¼šç½‘å…³é”™è¯¯
  - 503ï¼šæœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨
  - 504ï¼šæœåŠ¡å™¨å¤„ç†è¶…æ—¶

### 1.5 è®¤è¯

- OAuth 2ä½¿ç”¨äº†[æ‰¿è½½ä»¤ç‰Œ(Bearer tokens](http://tools.ietf.org/html/rfc6750)) å¹¶ä¸”ä¾èµ–äºSSLçš„åº•å±‚ä¼ è¾“åŠ å¯†ã€‚
- CORS

### 1.6 ç¼“å­˜

```sh
# TODO Etag or Last-Modified
```

### 1.7 é”™è¯¯

```json
{
  "code": 1234,
  "message": "Something bad happened :(",
  "description": "More details about the error here"
}
```
PUT or POST
```json
{
  "code": 1024,
  "message": "Validation Failed",
  "errors": [
    {
      "code": 5432,
      "field": "first_name",
      "message": "First name cannot have fancy characters"
    },
    {
      "code": 5622,
      "field": "password",
      "message": "Password cannot be blank"
    }
  ]
}
```

## 2. RESTful APIè®¾è®¡ Checklist

| é—®é¢˜                                                                  |            é€‰æ‹©             |                              å¤‡æ³¨                              |
| :-------------------------------------------------------------------- | :-------------------------: | :------------------------------------------------------------: |
| **URL**                                                               |                             |                                                                |
| API Path é‡Œé¢ Prefix                                                  |           `/api`            |                                                                |
| Path é‡Œé¢æ˜¯å¦åŒ…å« API ç‰ˆæœ¬                                            |              âœ…              |                           `/api/v1/`                           |
| Path æ˜¯å¦åŒ…å«åŠ¨ä½œ                                                     |        å°½å¯èƒ½ä¸åŒ…æ‹¬         |                       ä¾‹å¤–ï¼š`auth/login`                       |
| æ¨¡å‹ ID å½¢å¼                                                          |  Readable Stable Identity   |                                                                |
| URL ä¸­æ¨¡å‹å•æ•°è¿˜æ˜¯å¤æ•°                                                |            å¤æ•°             |                                                                |
| èµ„æºæ˜¯ä¸€çº§ï¼ˆå¹³é“ºï¼‰è¿˜æ˜¯å¤šçº§ï¼ˆåµŒå¥—ï¼‰                                    |         å¤šçº§ + ä¸€çº§         | æ³¨ï¼š80% æƒ…å†µéƒ½æ˜¯éµå¾ªæ¨¡å‹çš„å½’å±ï¼Œå°‘é‡æƒ…å†µï¼ˆå¸¸è§åœ¨æœç´¢ï¼‰ä½¿ç”¨ä¸€çº§ |
| æœç´¢å¦‚ä½•å®ç°ï¼Œç‹¬ç«‹æ¥å£ï¼ˆ`/models/search`ï¼‰è¿˜æ˜¯åŸºäºåˆ—è¡¨`/models/` æ¥å£ |            ç»Ÿä¸€             |                         `/search` æ¥å£                         |
| æ˜¯å¦æœ‰ Alias URL                                                      |              ğŸš«              |                             ç®€å•ç‚¹                             |
| URL ä¸­æ¨¡å‹æ˜¯å¦å…è®¸ç¼©å†™ï¼ˆæˆ–ç²¾ç®€ï¼‰                                      |              âœ…              |               ä¸€æ—¦åšäº†ç²¾ç®€ï¼Œéœ€è¦åœ¨æœ¯è¯­è¡¨æ ‡è®°å‡ºæ¥               |
| URL ä¸­æ¨¡å‹å¤šä¸ªè¯è¯­æ‹¼æ¥çš„è¿å­—ç¬¦                                        |             `-`             |                                                                |
| **Header**                                                            |                             |                                                                |
| æ˜¯å¦æ‰€æœ‰ Verb éƒ½ä½¿ç”¨ POST                                             |              ğŸš«              |                                                                |
| ä¿®æ”¹ï¼ˆModifyï¼‰åŠ¨ä½œæ˜¯ POST è¿˜æ˜¯ PATCHï¼Ÿ                                |            POST             |                                                                |
| HTTP Status è¿”å›å€¼                                                    |    å……åˆ†åˆ©ç”¨ HTTP Status     |                                                                |
| æ˜¯å¦ä½¿ç”¨è€ƒè™‘é™æµç³»ç»Ÿ                                                  |            âœ… 429            |                                                                |
| æ˜¯å¦ä½¿ç”¨ç¼“å­˜ç³»ç»Ÿ                                                      |              ğŸš«              |              ç®€å•ä¸€äº›ï¼Œä½¿ç”¨åŠ¨æ€æ•°æ®ï¼Œå»é™¤ç¼“å­˜èƒ½åŠ›              |
| æ˜¯å¦æ ¡éªŒ UserAgent                                                    |              âœ…              |                                                                |
| æ˜¯å¦æ ¡éªŒ Referrral                                                    |              ğŸš«              |                                                                |
| **Request**                                                           |                             |                                                                |
| å¤æ‚çš„å‚æ•°æ˜¯æ”¾åˆ° Form Fields è¿˜æ˜¯å•ç‹¬ä¸€ä¸ª JSON Body                   |            Body             |                                                                |
| å­èµ„æºæ˜¯ä¸€æ¬¡æ€§æŸ¥è¯¢è¿˜æ˜¯ç‹¬ç«‹æŸ¥è¯¢                                        |            åµŒå¥—             |                                                                |
| åˆ†é¡µå‚æ•°å­˜æ”¾                                                          |          URL Query          |                                                                |
| åˆ†é¡µæ–¹å¼                                                              |            Page             |                                                                |
| åˆ†é¡µæ§åˆ¶è€…                                                            |           æœåŠ¡ç«¯            |                                                                |
| **Response**                                                          |                             |                                                                |
| æ¨¡å‹å‘ˆç°ç§ç±»                                                          |          å¤šç§æ¨¡å‹           |                  ä½¿ç”¨çš„ BO / VO / Tiny / Rich                  |
| å¤§æ¨¡å‹å¦‚ä½•åŒ…å«å­æ¨¡å‹æ¨¡å‹                                              | æ ¸å¿ƒæ¨¡å‹ + å¤šæ¬¡å…³è”èµ„æºæŸ¥è¯¢ |                                                                |
| å­—æ®µè¿”å›æ˜¯æŒ‰éœ€è¿˜æ˜¯å½’å¹¶è¿˜æ˜¯ç»Ÿä¸€                                        |            ç»Ÿä¸€             |    Tiny Modelï¼ˆå¯é€‰ï¼‰ / Modelï¼ˆé»˜è®¤ï¼‰ / Rich Modelï¼ˆå¯é€‰ï¼‰     |
| å­—æ®µè¡¨ç°æ ¼å¼                                                          |        `snake_case`         |                                                                |
| é”™è¯¯ç                                                                 |             æ—               |                    æ³¨ï¼šå¾ˆå¤šåœºæ™¯åªè¦ message                    |
| é”™è¯¯æ ¼å¼                                                              |          å…¨å±€ç»Ÿä¸€           |                                                                |
| æ—¶åŒº                                                                  |          ISO 8601           |                åªä½¿ç”¨ä¸€ç§æ ¼å¼ï¼Œä¸å†æ”¯æŒå¤šç§æ–¹æ¡ˆ                |

*ä¿®æ”¹è‡ªï¼š[å®ç”¨ Web API è§„èŒƒ](https://blog.alswl.com/2023/04/web-api-guidelines/#æˆ‘ä¸ªäººé£æ ¼)*

## 3. API æ–‡æ¡£

OpenAPI API æ¥å£è§„èŒƒï¼Œæ˜¯ä¸€ç§å®šä¹‰ RESTful API çš„æ ‡å‡†ï¼Œå®ƒæ˜¯åŸºäº Swagger é¡¹ç›®çš„å¼€æºè§„èŒƒï¼Œå¯ä»¥ç”¨ YAML æˆ– JSON æ ¼å¼ç¼–å†™ API æ–‡æ¡£ã€‚åŒ…æ‹¬ API çš„åŸºæœ¬ä¿¡æ¯ã€æ•´ä½“è®¾è®¡ã€å®‰å…¨ã€è¯·æ±‚ã€å“åº”ç­‰ç­‰ã€‚

> RESTful API åªæ˜¯ä¸€ç§é£æ ¼æŒ‡å¯¼ï¼Œæ²¡æœ‰è§„èŒƒï¼ˆè½åœ°ï¼‰ï¼ŒOpenAPI æ˜¯ä¸€ç§å°† RESTful API è§„èŒƒåŒ–çš„æ ‡å‡†ï¼Œå¹¶è¿›è¡Œæ‰©å±•ã€‚

- https://openapi-map.apihandyman.io/
- https://bump.sh/blog/what-is-openapi ç‰ˆæœ¬é—´åŒºåˆ«

## References

- https://www.freecodecamp.org/news/rest-api-design-best-practices-build-a-rest-api/
- https://blog.alswl.com/2023/04/web-api-guidelines/
- https://www.cnblogs.com/traditional/tag/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E5%AF%86%20HTTP%20%E5%8D%8F%E8%AE%AE/
